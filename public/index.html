<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Token ç®¡ç†</title>
    <!-- é˜²æ­¢é¡µé¢é—ªçƒï¼šåœ¨æ¸²æŸ“å‰æ ¹æ®ç™»å½•çŠ¶æ€å’ŒTabçŠ¶æ€è®¾ç½®åˆå§‹æ˜¾ç¤º -->
    <script>
        (function() {
            var isLoggedIn = localStorage.getItem('authToken');
            var currentTab = localStorage.getItem('currentTab') || 'tokens';
            var classes = ['auth-ready'];
            if (isLoggedIn) classes.push('logged-in');
            if (currentTab === 'settings') classes.push('tab-settings');
            document.documentElement.className = classes.join(' ');
            // æ£€æµ‹å­—ä½“åŠ è½½
            if ('fonts' in document) {
                document.fonts.ready.then(function() {
                    document.documentElement.classList.add('fonts-loaded');
                });
            } else {
                // åå¤‡æ–¹æ¡ˆï¼šå»¶è¿Ÿæ·»åŠ 
                setTimeout(function() {
                    document.documentElement.classList.add('fonts-loaded');
                }, 1000);
            }
        })();
    </script>
    <style>
/* é˜²æ­¢é—ªçƒçš„å…³é”®æ ·å¼ - æ¥è‡ª binary-build */
html:not(.auth-ready) #loginForm,
html:not(.auth-ready) #mainContent { visibility: hidden; }
/* ç™»å½•çŠ¶æ€æ˜¾ç¤ºæ§åˆ¶ - åˆå¹¶ä¸¤ä¸ªåˆ†æ”¯ */
.logged-in #loginForm { display: none !important; }
.logged-in #mainContent { display: flex !important; }
html:not(.logged-in) #mainContent { display: none !important; }
/* TabçŠ¶æ€ç®¡ç† - æ¥è‡ª binary-build */
html.tab-settings #tokensPage { display: none !important; }
html.tab-settings #settingsPage { display: block !important; }
html.tab-settings .tab[data-tab="tokens"] { 
    background: transparent !important;
    color: var(--text-light, #888) !important; 
}
html.tab-settings .tab[data-tab="settings"] { 
    background: var(--primary, #4f46e5) !important; 
    color: white !important; 
}
    </style>
    <!-- ä¸»æ ·å¼è¡¨ - ä¼˜å…ˆåŠ è½½ -->
    <link rel="stylesheet" href="style.css">
    <!-- é¢„è¿æ¥å­—ä½“æœåŠ¡å™¨ -->
    <link rel="preconnect" href="https://font.sec.miui.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- å­—ä½“å¼‚æ­¥åŠ è½½ - ä¸é˜»å¡æ¸²æŸ“ -->
    <link rel="stylesheet" href="https://font.sec.miui.com/font/css?family=MiSans:400,500,600,700:Chinese_Simplify,Latin&display=swap" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:wght@400;700&display=swap" media="print" onload="this.media='all'">
    <noscript>
        <link rel="stylesheet" href="https://font.sec.miui.com/font/css?family=MiSans:400,500,600,700:Chinese_Simplify,Latin&display=swap">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:wght@400;700&display=swap">
    </noscript>
</head>
<body>
    <div class="container">
        <!-- ç™»å½•è¡¨å• -->
        <div id="loginForm" class="login-form">
            <h2>Token ç®¡ç†</h2>
            <form id="login">
                <div class="form-group">
                    <label>ğŸ‘¤ ç”¨æˆ·å</label>
                    <input type="text" id="username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label>ğŸ”‘ å¯†ç </label>
                    <input type="password" id="password" required autocomplete="current-password">
                </div>
                <button type="submit">ç™»å½•</button>
            </form>
        </div>

        <!-- ä¸»å†…å®¹ -->
        <div id="mainContent" class="main-content hidden">
            <div class="header">
            <div class="tabs">
                <button class="tab active" data-tab="tokens" onclick="switchTab('tokens')">ğŸ¯ Token</button>
                <button class="tab" data-tab="settings" onclick="switchTab('settings')">âš™ï¸ è®¾ç½®</button>
            </div>
                <div class="header-right">
                    <button onclick="logout()">ğŸšª é€€å‡º</button>
                </div>
            </div>
            <div class="content">
                <!-- Tokenç®¡ç†é¡µé¢ -->
                <div id="tokensPage">
                    <!-- ç»Ÿè®¡å¡ç‰‡ + æ“ä½œæŒ‰é’® åˆå¹¶ -->
                    <div class="top-bar">
                        <div class="stats-inline">
                            <div class="stat-item">
                                <span class="stat-num" id="totalTokens">0</span>
                                <span class="stat-text">æ€»æ•°</span>
                            </div>
                            <div class="stat-item success">
                                <span class="stat-num" id="enabledTokens">0</span>
                                <span class="stat-text">å¯ç”¨</span>
                            </div>
                            <div class="stat-item danger">
                                <span class="stat-num" id="disabledTokens">0</span>
                                <span class="stat-text">ç¦ç”¨</span>
                            </div>
                        </div>
                        <div class="action-btns">
                            <button type="button" onclick="showOAuthModal()" class="btn btn-success btn-sm">ğŸ” OAuth</button>
                            <button type="button" onclick="showManualModal()" class="btn btn-secondary btn-sm">âœï¸ æ‰‹åŠ¨</button>
                            <button type="button" onclick="loadTokens()" class="btn btn-warning btn-sm">ğŸ”„ åˆ·æ–°</button>
                            <button type="button" onclick="toggleSensitiveInfo()" class="btn btn-sm" id="toggleSensitiveBtn" title="éšè—/æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯">ğŸ‘ï¸ æ˜¾ç¤º</button>
                        </div>
                    </div>

                    <!-- Tokenç½‘æ ¼ -->
                    <div id="tokenList" class="token-grid">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“¦</div>
                            <div class="empty-state-text">æš‚æ— Token</div>
                            <div class="empty-state-hint">ç‚¹å‡»ä¸Šæ–¹OAuthæŒ‰é’®æ·»åŠ Token</div>
                        </div>
                    </div>
                </div>

                <!-- è®¾ç½®é¡µé¢ -->
                <div id="settingsPage" class="hidden">
                    <form id="configForm" class="config-form">
                        <div class="config-grid">
                            <!-- æœåŠ¡å™¨é…ç½® -->
                            <div class="config-section">
                                <h4>ğŸ–¥ï¸ æœåŠ¡å™¨</h4>
                                <div class="form-row-inline">
                                    <div class="form-group compact">
                                        <label>ç«¯å£</label>
                                        <input type="number" name="PORT" placeholder="8045">
                                    </div>
                                    <div class="form-group compact">
                                        <label>ç›‘å¬åœ°å€</label>
                                        <input type="text" name="HOST" placeholder="0.0.0.0">
                                    </div>
                                </div>
                                <div class="form-row-inline">
                                    <div class="form-group compact">
                                        <label>æœ€å¤§è¯·æ±‚å¤§å°</label>
                                        <input type="text" name="MAX_REQUEST_SIZE" placeholder="500mb">
                                    </div>
                                    <div class="form-group compact">
                                        <label>APIå¯†é’¥</label>
                                        <input type="password" name="API_KEY" placeholder="ç•™ç©ºåˆ™ä¸éªŒè¯">
                                    </div>
                                </div>
                                <div class="form-row-inline switch-row">
                                    <div class="form-group compact switch-group">
                                        <label>è·³è¿‡éªŒè¯ <span class="help-tip" data-tooltip="è·³è¿‡ProjectIdè·å–ï¼Œç›´æ¥éšæœºç”Ÿæˆï¼ˆä»…Proè´¦å·ï¼‰">?</span></label>
                                        <label class="switch">
                                            <input type="checkbox" name="SKIP_PROJECT_ID_FETCH">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="form-group compact switch-group">
                                        <label>åŸç”ŸAxios <span class="help-tip" data-tooltip="ä½¿ç”¨åŸç”Ÿaxiosè€ŒéTLSæŒ‡çº¹è¯·æ±‚å™¨">?</span></label>
                                        <label class="switch">
                                            <input type="checkbox" name="USE_NATIVE_AXIOS">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="form-group compact">
                                    <label>å›¾ç‰‡è®¿é—®é“¾æ¥</label>
                                    <input type="text" name="IMAGE_BASE_URL" placeholder="https://your-domain.zeabur.app">
                                </div>
                                <div class="form-group compact">
                                    <label>ä»£ç†åœ°å€</label>
                                    <input type="text" name="PROXY" placeholder="http://127.0.0.1:7890">
                                </div>
                            </div>

                            <!-- æ¨¡å‹é»˜è®¤å‚æ•° -->
                            <div class="config-section">
                                <h4>ğŸ›ï¸ æ¨¡å‹å‚æ•°</h4>
                                <div class="form-row-inline">
                                    <div class="form-group compact">
                                        <label>æ¸©åº¦</label>
                                        <input type="number" step="0.1" name="DEFAULT_TEMPERATURE" placeholder="1">
                                    </div>
                                    <div class="form-group compact">
                                        <label>Top P</label>
                                        <input type="number" step="0.01" name="DEFAULT_TOP_P" placeholder="1">
                                    </div>
                                </div>
                                <div class="form-row-inline">
                                    <div class="form-group compact">
                                        <label>Top K</label>
                                        <input type="number" name="DEFAULT_TOP_K" placeholder="50">
                                    </div>
                                    <div class="form-group compact">
                                        <label>æœ€å¤§Token</label>
                                        <input type="number" name="DEFAULT_MAX_TOKENS" placeholder="32000">
                                    </div>
                                </div>
                                <div class="form-group compact highlight">
                                    <label>æ€è€ƒé¢„ç®— <span class="help-tip" data-tooltip="æ€è€ƒæ¨¡å‹çš„æ€è€ƒtokené¢„ç®—ï¼Œå½±å“æ¨ç†æ·±åº¦">?</span></label>
                                    <input type="number" name="DEFAULT_THINKING_BUDGET" placeholder="16000">
                                </div>
                                <div class="form-row-inline switch-row">
                                    <div class="form-group compact switch-group">
                                        <label>ä¸Šä¸‹æ–‡System <span class="help-tip" data-tooltip="åˆå¹¶å¼€å¤´è¿ç»­çš„systemæ¶ˆæ¯åˆ°SystemInstruction">?</span></label>
                                        <label class="switch">
                                            <input type="checkbox" name="USE_CONTEXT_SYSTEM_PROMPT">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="form-group compact">
                                    <label>ç³»ç»Ÿæç¤ºè¯</label>
                                    <textarea name="SYSTEM_INSTRUCTION" rows="3" placeholder="å¯é€‰çš„ç³»ç»Ÿæç¤ºè¯"></textarea>
                                </div>
                            </div>

                            <!-- è½®è¯¢ç­–ç•¥ä¸æ€§èƒ½ä¼˜åŒ– -->
                            <div class="config-section">
                                <h4>ğŸ”„ è½®è¯¢ä¸æ€§èƒ½</h4>
                                <div class="form-row-inline switch-row">
                                    <div class="form-group compact switch-group">
                                        <label>é€ä¼ ç­¾å <span class="help-tip" data-tooltip="å°†å“åº”ä¸­çš„thoughtSignatureé€ä¼ åˆ°å®¢æˆ·ç«¯">?</span></label>
                                        <label class="switch">
                                            <input type="checkbox" name="PASS_SIGNATURE_TO_CLIENT">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="form-row-inline">
                                    <div class="form-group compact">
                                        <label>ç­–ç•¥æ¨¡å¼ <span class="help-tip" data-tooltip="å‡è¡¡è´Ÿè½½ï¼šæ¯æ¬¡è¯·æ±‚åˆ‡æ¢Token&#10;é¢åº¦è€—å°½ï¼šç”¨å®Œé¢åº¦æ‰åˆ‡æ¢&#10;è‡ªå®šä¹‰æ¬¡æ•°ï¼šæŒ‡å®šæ¬¡æ•°ååˆ‡æ¢">?</span></label>
                                        <select name="ROTATION_STRATEGY" id="rotationStrategy" onchange="toggleRequestCountInput()">
                                            <option value="round_robin">å‡è¡¡è´Ÿè½½</option>
                                            <option value="quota_exhausted">é¢åº¦è€—å°½åˆ‡æ¢</option>
                                            <option value="request_count">è‡ªå®šä¹‰æ¬¡æ•°</option>
                                        </select>
                                    </div>
                                    <div class="form-group compact" id="requestCountGroup">
                                        <label>æ¯Tokenè¯·æ±‚æ¬¡æ•° <span class="help-tip" data-tooltip="è‡ªå®šä¹‰æ¬¡æ•°æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªTokenå¤„ç†å¤šå°‘æ¬¡è¯·æ±‚ååˆ‡æ¢">?</span></label>
                                        <input type="number" name="ROTATION_REQUEST_COUNT" min="1" placeholder="10">
                                    </div>
                                </div>
                                <div class="rotation-status" id="rotationStatus">
                                    <span class="rotation-label">å½“å‰çŠ¶æ€:</span>
                                    <span id="currentRotationInfo">åŠ è½½ä¸­...</span>
                                </div>
                                <div class="form-row-inline">
                                    <div class="form-group compact">
                                        <label>è¶…æ—¶(ms)</label>
                                        <input type="number" name="TIMEOUT" placeholder="300000">
                                    </div>
                                    <div class="form-group compact">
                                        <label>429é‡è¯•æ¬¡æ•°</label>
                                        <input type="number" name="RETRY_TIMES" placeholder="0">
                                    </div>
                                </div>

                                <div class="form-row-inline">
                                    <div class="form-group compact">
                                        <label>å¿ƒè·³é—´éš”(ms) <span class="help-tip" data-tooltip="SSEå¿ƒè·³é—´éš”ï¼Œé˜²æ­¢CFè¶…æ—¶æ–­è¿">?</span></label>
                                        <input type="number" name="HEARTBEAT_INTERVAL" placeholder="15000">
                                    </div>
                                    <div class="form-group compact">
                                        <label>å†…å­˜é˜ˆå€¼(MB) <span class="help-tip" data-tooltip="è¶…è¿‡æ­¤å€¼è§¦å‘GCæ¸…ç†">?</span></label>
                                        <input type="number" name="MEMORY_THRESHOLD" placeholder="100">
                                    </div>
                                </div>
                                <div class="form-group compact">
                                    <label>ğŸ”¤ ç•Œé¢å­—ä½“å¤§å° (px)</label>
                                    <div class="font-size-control">
                                        <input type="range" id="fontSizeRange" min="10" max="24" value="18" oninput="changeFontSize(this.value)">
                                        <input type="number" id="fontSizeInput" min="10" max="24" value="18" onchange="changeFontSize(this.value)" style="width: 60px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="config-actions">
                            <button type="submit" class="btn btn-success">ğŸ’¾ ä¿å­˜é…ç½®</button>
                            <button type="button" onclick="loadConfig()" class="btn btn-secondary">ğŸ”„ é‡æ–°åŠ è½½</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- æŒ‰ä¾èµ–é¡ºåºåŠ è½½æ¨¡å— -->
    <script src="js/utils.js" defer></script>
    <script src="js/ui.js" defer></script>
    <script src="js/auth.js" defer></script>
    <script src="js/quota.js" defer></script>
    <script src="js/tokens.js" defer></script>
    <script src="js/config.js" defer></script>
    <script src="js/main.js" defer></script>
</body>
</html>
